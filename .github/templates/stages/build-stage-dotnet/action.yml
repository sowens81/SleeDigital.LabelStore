name: build-stage-dotnet
description: Stage for Building and Testing a .Net Solution.

inputs: 
    dotnetVersion:
        description: usage of the paramter
        required: true
    dotnetProjectName:
        description: Name of the .Net Projects where Coverage test will be run.
        required: true
    solutionDirectory:
        description: Directory location of the .Net Solution file.
        required: true
    
runs:
    using: "composite"
    steps:
        - name: Setup .NET
        uses: actions/setup-dotnet@v2
        with:
            dotnet-version: ${{ inputs.dotnetVersion}}
        
        - name: Restore dependencies
        run: |
            cd ${{ inputs.solutionDirectory }}
            dotnet restore
        
        - name: Build Solution
        run: |
            cd ${{ inputs.solutionDirectory }}
            dotnet build --no-restore
        
        - name: Test Solution
        run : |
            cd ${{ inputs.solutionDirectory }}
            run: dotnet test --no-build --verbosity normal

        
        - name: dotnet-codecoverage
        if: ${{ github.event_name == 'push' && github.ref == 'refs/heads/Main' }}
        uses: ./.github/templates/steps/dotnet-codecovrage
        with:
            dotnetProjectName: ${{ inputs.dotnetProjectName}}
            solutionDirectory: ${{ inputs.solutionDirectory}}